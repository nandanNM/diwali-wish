<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Diwali</title>
    <link rel="icon" href="favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Salsa&family=Style+Script&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Name Input Modal -->
    <div id="nameInputModal" class="modal">
      <div class="modal-content">
        <h2>Welcome to Diwali Wishes! 🪔</h2>
        <p>
          Enter your name to brighten someone’s Diwali with a heartfelt message.
        </p>
        <form id="nameForm">
          <input
            type="text"
            id="senderNameInput"
            placeholder="Enter your name"
            required />
          <button type="submit">Continue</button>
        </form>
      </div>
    </div>

    <section class="fireworks" id="sec1"></section>
    <section class="hero-section">
      <img class="jhalar fade-in-left" src="images/jhalar.png" alt="jhalar" />
      <div class="pragraph-and-audio fade-in-up">
        <p>
          Hi <span id="receiver"></span>,
          <br />
          You mean the world to me... So this Diwali, I made something for you!
        </p>
        <div class="audio-container">
          <img src="icons/music-icon.svg" alt="music-icon" />
          <span class="soulful-music">&nbsp;&nbsp; Soulful Music &nbsp;</span>
          <img
            class="playing-music-icon"
            src="icons/playing-music-icon.svg"
            alt="playing-music-icon" />
          <audio src="music/sitar-and-tanpura.mp3" controls></audio>
        </div>
      </div>
      <img
        class="deekpak first-deepak fade-in-right"
        src="images/deepak.png"
        alt="deepak" />
      <img
        class="deekpak second-deepak fade-in-right"
        src="images/deepak.png"
        alt="deepak" />

      <!-- Animated Diya -->
      <div class="diya-container diya-small diya-hero-top fade-in-scale">
        <div class="diya-shadow"></div>
        <div class="diya-body"></div>
        <div class="diya-wick-container">
          <div class="diya-wick"></div>
        </div>
        <div class="diya-flame"></div>
        <div class="diya-glow"></div>
        <div class="diya-sparkles">
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
        </div>
      </div>
    </section>
    <section class="lakshmi-ganesha-section">
      <div class="horizontal-divider fade-in-up">
        <div class="horizontal-line"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="horizontal-line"></div>
      </div>
      <img
        class="lakshmi-ganesha-img fade-in-scale"
        src="images/lakshmi-ganesha.png"
        alt="lakshmi-ganesha" />
      <h2 class="fade-in-up">Wishing You a Blessed and Prosperous Deepawali</h2>
      <div class="diya-container diya-small fade-in-scale">
        <div class="diya-shadow"></div>
        <div class="diya-body"></div>
        <div class="diya-wick-container">
          <div class="diya-wick"></div>
        </div>
        <div class="diya-flame"></div>
        <div class="diya-glow"></div>
        <div class="diya-sparkles">
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
          <div class="diya-sparkle"></div>
        </div>
      </div>
      <div class="white-card-container fade-in-up">
        <div class="white-card">
          <p>People say, "Diwali is the festival of lights."</p>
          <p>
            May the divine light of Diwali fill your home with endless joy,
            prosperity, and good health. May happiness glow in your heart and
            peace light up your life. Wishing you and your family a bright and
            blissful Diwali! 🪔🌟
          </p>
        </div>
        <img class="little-girl" src="images/little-girl.png" alt="" />
      </div>
      <div class="horizontal-divider fade-in-up">
        <div class="horizontal-line"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="horizontal-line"></div>
      </div>
      <div class="lakshmi-ganesha-card fade-in-scale">
        <img src="images/lakshmi.png" alt="lakshmi" />
        <img src="images/ganesh.png" alt="ganesh" />
      </div>

      <!-- Large Animated Diya
      <div class="dilarge-diya-container">
        <div class="shadow"></div>
        <div class="diya">
          <div class="line-1"></div>
          <div class="line-2"></div>
          <div class="dots"></div>
        </div>
        <div class="inside">
          <div class="light"></div>
          <div class="flame"></div>
        </div>
      </div> -->
      <div class="thank-you-text fade-in-up">
        <p>Happy Diwali and,</p>
        <h2>Thank You For Everything...</h2>
      </div>
      <p class="my-name fade-in-up">
        Made with 💜 By <span id="sender"></span>
      </p>

      <!-- Share Button -->

      <div class="share-container fade-in-up">
        <p href="#" class="fade-in-up">
          Created By <span id="sender">codernandan</span>
        </p>
        <button id="shareButton" class="share-button">
          <span>🔗</span> Share this Diwali Wish
        </button>
        <div id="shareMessage" class="share-message"></div>

        <!-- Small Diya for decoration -->
        <div class="diya-container diya-small diya-share-bottom fade-in-scale">
          <div class="diya-shadow"></div>
          <div class="diya-body"></div>
          <div class="diya-wick-container">
            <div class="diya-wick"></div>
          </div>
          <div class="diya-flame"></div>
          <div class="diya-glow"></div>
          <div class="diya-sparkles">
            <div class="diya-sparkle"></div>
            <div class="diya-sparkle"></div>
            <div class="diya-sparkle"></div>
            <div class="diya-sparkle"></div>
          </div>
        </div>
      </div>
    </section>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="jquery.fireworks.js"></script>
    <script type="text/javascript">
      // Check if mobile device
      var isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        ) || window.innerWidth < 768;

      $(".fireworks").fireworks({
        sound: true, // enable sound (we'll unlock audio on first gesture for mobile)
        opacity: 0.9,
        width: "100%",
        height: "100%",
        duration: 8000, // 8 seconds duration
        mobileOptimized: true,
      });

      // Create/resume the shared audio context used by the fireworks plugin.
      // On mobile browsers audio is blocked until a user gesture. We listen for
      // the first touchstart (mobile) or click (desktop) to unlock audio so the
      // boom plays during the animation.
      function unlockAudio() {
        try {
          var ctx =
            window.__fireworksAudioCtx ||
            new (window.AudioContext || window.webkitAudioContext)();
          window.__fireworksAudioCtx = ctx;
          if (ctx.state === "suspended") ctx.resume();

          // tiny silent oscillator to ensure unlocking on some browsers
          try {
            var now = ctx.currentTime;
            var osc = ctx.createOscillator();
            var gain = ctx.createGain();
            gain.gain.setValueAtTime(0, now);
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start(now);
            osc.stop(now + 0.01);
          } catch (e) {}
        } catch (e) {
          console.log("Audio unlock failed", e);
        }
      }

      // Attach once-only listeners for touch and click
      document.addEventListener(
        "touchstart",
        function onFirstTouch() {
          unlockAudio();
          document.removeEventListener("touchstart", onFirstTouch);
        },
        { passive: true }
      );

      document.addEventListener(
        "click",
        function onFirstClick() {
          unlockAudio();
          document.removeEventListener("click", onFirstClick);
        },
        { once: true }
      );
    </script>
    <script>
      // Get URL parameters
      const urlParams = new URLSearchParams(location.search);
      const receiverParam = urlParams.get("receiver");
      const senderParam = urlParams.get("sender");

      const receiverName = document.querySelector("#receiver");
      const senderName = document.querySelector("#sender");
      const nameInputModal = document.getElementById("nameInputModal");
      const nameForm = document.getElementById("nameForm");
      const senderNameInput = document.getElementById("senderNameInput");
      const shareButton = document.getElementById("shareButton");
      const shareMessage = document.getElementById("shareMessage");

      // Check if we have URL parameters
      if (receiverParam && senderParam) {
        // We have both parameters, show the personalized content
        receiverName.innerText = receiverParam;
        senderName.innerText = senderParam;
        nameInputModal.style.display = "none";
      } else if (!senderParam && !receiverParam) {
        // We have only sender param (common when sharing). Treat the receiver as 'You'
        receiverName.innerText = "You";
        senderName.innerText = senderParam;
        nameInputModal.style.display = "none"; // don't ask for input when link already contains sender
      } else {
        // No parameters, show name input form
        nameInputModal.style.display = "flex";
        receiverName.innerText = "Friend";
        senderName.innerText = "You";
      }

      // Handle name form submission
      nameForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const enteredName = senderNameInput.value.trim();
        if (enteredName) {
          receiverName.innerText = enteredName;
          nameInputModal.style.display = "none";

          // Update URL with receiver name
          const newUrl = new URL(window.location);
          newUrl.searchParams.set("receiver", enteredName);
          window.history.replaceState({}, "", newUrl);
        }
      });

      // Handle share button click
      shareButton.addEventListener("click", function () {
        const currentSender = senderName.innerText;
        const currentReceiver = receiverName.innerText;

        // Create shareable URL
        const shareUrl = new URL(
          window.location.origin + window.location.pathname
        );
        // set both receiver and sender params correctly
        shareUrl.searchParams.set("sender", currentReceiver);

        // Personalized message that prompts the friend to click and reveal the wish
        const shareText = `Hi there! ${(() => {
          const name = currentReceiver.trim().split(/\s+/)[0];
          return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
        })()} just sent you a special Diwali surprise 🎁
Tap the link to reveal your wish and spread the light! 🪔✨\n`;

        // Combine message + link into a single text so apps won't drop the message
        const combinedText = shareText + shareUrl.toString();

        // Try to use Web Share API if available
        if (navigator.share) {
          navigator
            .share({
              title: "Happy Diwali Wishes! 🪔",
              text: combinedText,
            })
            .then(() => {
              showShareMessage("Shared successfully! 🎉");
            })
            .catch((error) => {
              console.log("Error sharing:", error);
              fallbackShare(shareUrl.toString(), shareText);
            });
        } else {
          // Fallback for browsers that don't support Web Share API
          fallbackShare(shareUrl.toString(), shareText);
        }
      });

      function fallbackShare(url, text) {
        const fullMessage = `${text}\n${url}`;

        // First try to copy the full message to clipboard
        navigator.clipboard
          .writeText(fullMessage)
          .then(() => {
            showShareMessage(
              "Message copied to clipboard! Opening WhatsApp..."
            );

            // Open WhatsApp web / app with prefilled text as an extra sharing option
            try {
              const waUrl = `https://wa.me/?text=${encodeURIComponent(
                fullMessage
              )}`;
              window.open(waUrl, "_blank");
            } catch (e) {
              console.log("Could not open WhatsApp:", e);
            }
          })
          .catch(() => {
            // If clipboard fails, still try opening WhatsApp with the message
            try {
              const waUrl = `https://wa.me/?text=${encodeURIComponent(
                fullMessage
              )}`;
              window.open(waUrl, "_blank");
              showShareMessage(
                "Opening WhatsApp to share...\nIf that fails, copy this link: " +
                  url
              );
            } catch (e) {
              // If everything fails, show the URL fallback
              showShareMessage(`Share this link: ${url}`);
            }
          });
      }

      function showShareMessage(message) {
        shareMessage.textContent = message;
        shareMessage.style.display = "block";
        setTimeout(() => {
          shareMessage.style.display = "none";
        }, 3000);
      }

      // Scroll Animation Observer
      const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("animate-in");
          }
        });
      }, observerOptions);

      // Observe all elements with animation classes
      document.addEventListener("DOMContentLoaded", () => {
        const animatedElements = document.querySelectorAll(
          ".fade-in-up, .fade-in-left, .fade-in-right, .fade-in-scale"
        );
        animatedElements.forEach((el) => {
          observer.observe(el);
        });
      });

      // Smooth scroll for any internal links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          }
        });
      });

      // Add loading animation
      window.addEventListener("load", () => {
        document.body.classList.add("loaded");
      });

      // Diya Interactive Effects
      document.addEventListener("DOMContentLoaded", () => {
        const diyas = document.querySelectorAll(".diya-container");

        diyas.forEach((diya, index) => {
          // Add random delay to each diya for more natural effect
          const randomDelay = Math.random() * 2;
          diya.style.animationDelay = `${randomDelay}s`;

          // Add hover effect to make flame brighter
          diya.addEventListener("mouseenter", () => {
            const flame = diya.querySelector(".diya-flame");
            const glow = diya.querySelector(".diya-glow");
            if (flame) {
              flame.style.filter = "blur(0.5px) brightness(1.2)";
              flame.style.transform = "translateX(-50%) scale(1.1)";
            }
            if (glow) {
              glow.style.opacity = "1";
              glow.style.transform = "translateX(-50%) scale(1.5)";
            }
          });

          diya.addEventListener("mouseleave", () => {
            const flame = diya.querySelector(".diya-flame");
            const glow = diya.querySelector(".diya-glow");
            if (flame) {
              flame.style.filter = "blur(1px)";
              flame.style.transform = "translateX(-50%) scale(1)";
            }
            if (glow) {
              glow.style.opacity = "0.6";
              glow.style.transform = "translateX(-50%) scale(1)";
            }
          });

          // Add click effect to create extra sparkles
          diya.addEventListener("click", () => {
            createExtraSparkles(diya);
          });
        });
      });

      function createExtraSparkles(diya) {
        const sparklesContainer = diya.querySelector(".diya-sparkles");
        if (!sparklesContainer) return;

        // Create temporary sparkles
        for (let i = 0; i < 6; i++) {
          const sparkle = document.createElement("div");
          sparkle.className = "diya-sparkle";
          sparkle.style.position = "absolute";
          sparkle.style.width = "4px";
          sparkle.style.height = "4px";
          sparkle.style.background = "#fff";
          sparkle.style.borderRadius = "50%";
          sparkle.style.left = Math.random() * 100 + "%";
          sparkle.style.top = Math.random() * 100 + "%";
          sparkle.style.animation = "sparkleFloat 2s ease-out forwards";
          sparkle.style.animationDelay = Math.random() * 0.5 + "s";

          sparklesContainer.appendChild(sparkle);

          // Remove sparkle after animation
          setTimeout(() => {
            if (sparkle.parentNode) {
              sparkle.parentNode.removeChild(sparkle);
            }
          }, 2000);
        }
      }
    </script>
  </body>
</html>
