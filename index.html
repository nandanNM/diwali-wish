<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Diwali</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Salsa&family=Style+Script&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Name Input Modal -->
    <div id="nameInputModal" class="modal">
      <div class="modal-content">
        <h2>Welcome to Diwali Wishes! ü™î</h2>
        <p>
          Please enter the name of the person you want to send this Diwali
          greeting to:
        </p>
        <form id="nameForm">
          <input
            type="text"
            id="senderNameInput"
            placeholder="Enter receiver's name"
            required />
          <button type="submit">Continue</button>
        </form>
      </div>
    </div>

    <section class="fireworks" id="sec1"></section>
    <section class="hero-section">
      <img class="jhalar" src="images/jhalar.png" alt="jhalar" />
      <div class="pragraph-and-audio">
        <p>
          Hi <span id="receiver"></span>,
          <br />
          You mean the world to me... So this Diwali, I made something for you!
        </p>
        <div class="audio-container">
          <img src="icons/music-icon.svg" alt="music-icon" />
          <span class="soulful-music">&nbsp;&nbsp; Soulful Music &nbsp;</span>
          <img
            class="playing-music-icon"
            src="icons/playing-music-icon.svg"
            alt="playing-music-icon" />
          <audio src="music/sitar-and-tanpura.mp3" controls></audio>
        </div>
      </div>
      <img class="deekpak first-deepak" src="images/deepak.png" alt="deepak" />
      <img class="deekpak second-deepak" src="images/deepak.png" alt="deepak" />
    </section>
    <section class="lakshmi-ganesha-section">
      <div class="horizontal-divider">
        <div class="horizontal-line"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="horizontal-line"></div>
      </div>
      <img
        class="lakshmi-ganesha-img"
        src="images/lakshmi-ganesha.png"
        alt="lakshmi-ganesha" />
      <h2>Wishing You a Blessed and Prosperous Deepawali</h2>
      <div class="horizontal-divider">
        <div class="horizontal-line"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="horizontal-line"></div>
      </div>
      <div class="white-card-container">
        <div class="white-card">
          <p>People say, ‚ÄúDiwali is the festival of lights.‚Äù</p>
          <p>
            You know what, I can feel the positivity and happiness. My goal is
            to learn web development and I‚Äôm learning everyday, even today!
          </p>
        </div>
        <img class="little-girl" src="images/little-girl.png" alt="" />
      </div>
      <div class="horizontal-divider">
        <div class="horizontal-line"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="circle"></div>
        <div class="horizontal-line"></div>
      </div>
      <div class="lakshmi-ganesha-card">
        <img src="images/lakshmi.png" alt="lakshmi" />
        <img src="images/ganesh.png" alt="ganesh" />
      </div>
      <div class="thank-you-text">
        <p>Happy Diwali and,</p>
        <h2>Thank You For Everything...</h2>
      </div>
      <p class="my-name">Made with üíú By <span id="sender"></span></p>

      <!-- Share Button -->
      <div class="share-container">
        <button id="shareButton" class="share-button">
          <span>üîó</span> Share this Diwali Wish
        </button>
        <div id="shareMessage" class="share-message"></div>
      </div>
    </section>

    <script src="http://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="jquery.fireworks.js"></script>
    <script type="text/javascript">
      // Check if mobile device
      var isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        ) || window.innerWidth < 768;

      $(".fireworks").fireworks({
        sound: !isMobile, // Disable sound on mobile for better performance
        opacity: 0.9,
        width: "100%",
        height: "100%",
        duration: 8000, // 8 seconds duration
        mobileOptimized: true,
      });

      // Add user interaction to start audio context (required by browsers) - only on desktop
      if (!isMobile) {
        document.addEventListener(
          "click",
          function () {
            var audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            if (audioContext.state === "suspended") {
              audioContext.resume();
            }
          },
          { once: true }
        );
      }
    </script>
    <script>
      // Get URL parameters
      const urlParams = new URLSearchParams(location.search);
      const receiverParam = urlParams.get("receiver");
      const senderParam = urlParams.get("sender");

      const receiverName = document.querySelector("#receiver");
      const senderName = document.querySelector("#sender");
      const nameInputModal = document.getElementById("nameInputModal");
      const nameForm = document.getElementById("nameForm");
      const senderNameInput = document.getElementById("senderNameInput");
      const shareButton = document.getElementById("shareButton");
      const shareMessage = document.getElementById("shareMessage");

      // Check if we have URL parameters
      if (receiverParam && senderParam) {
        // We have both parameters, show the personalized content
        receiverName.innerText = receiverParam;
        senderName.innerText = senderParam;
        nameInputModal.style.display = "none";
      } else if (senderParam) {
        // We have sender but no receiver, show input for receiver
        receiverName.innerText = "Friend";
        senderName.innerText = senderParam;
        nameInputModal.style.display = "flex";
      } else {
        // No parameters, show name input form
        nameInputModal.style.display = "flex";
        receiverName.innerText = "Friend";
        senderName.innerText = "You";
      }

      // Handle name form submission
      nameForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const enteredName = senderNameInput.value.trim();
        if (enteredName) {
          receiverName.innerText = enteredName;
          nameInputModal.style.display = "none";

          // Update URL with receiver name
          const newUrl = new URL(window.location);
          newUrl.searchParams.set("receiver", enteredName);
          window.history.replaceState({}, "", newUrl);
        }
      });

      // Handle share button click
      shareButton.addEventListener("click", function () {
        const currentSender = senderName.innerText;
        const currentReceiver = receiverName.innerText;

        // Create shareable URL
        const shareUrl = new URL(
          window.location.origin + window.location.pathname
        );
        shareUrl.searchParams.set("receiver", currentReceiver);
        shareUrl.searchParams.set("sender", currentSender);

        const shareText = `Hi ${currentReceiver}! ${currentSender} sent you a beautiful Diwali wish! ü™î‚ú®`;

        // Try to use Web Share API if available
        if (navigator.share) {
          navigator
            .share({
              title: "Happy Diwali Wishes! ü™î",
              text: shareText,
              url: shareUrl.toString(),
            })
            .then(() => {
              showShareMessage("Shared successfully! üéâ");
            })
            .catch((error) => {
              console.log("Error sharing:", error);
              fallbackShare(shareUrl.toString(), shareText);
            });
        } else {
          // Fallback for browsers that don't support Web Share API
          fallbackShare(shareUrl.toString(), shareText);
        }
      });

      function fallbackShare(url, text) {
        // Copy to clipboard
        navigator.clipboard
          .writeText(`${text}\n${url}`)
          .then(() => {
            showShareMessage("Link copied to clipboard! üìã");
          })
          .catch(() => {
            // If clipboard fails, show the URL
            showShareMessage(`Share this link: ${url}`);
          });
      }

      function showShareMessage(message) {
        shareMessage.textContent = message;
        shareMessage.style.display = "block";
        setTimeout(() => {
          shareMessage.style.display = "none";
        }, 3000);
      }
    </script>
  </body>
</html>
